# SSAFY Project - CS Pedia

> 영화 정보 기반 추천 서비스



## :calendar: 제작기간

2021.11.17 ~ 2021.11.25

## :computer: 개발환경

- 언어
  - Python
  - Django
  - Node.js
  - Vue.js
- 도구
  - VSCode
  - Chrome Browser
- 아키텍처
  - Django REST API 서버 & Vue.js



## :information_desk_person: 팀원 및 업무 분담

- **김치우**
  - django
    - movies, community, accounts 서버 구현
  - Vue
    - 검색, 회원가입, 로그인
    - Design
- **이선구**
  - django
    - dump data를 가져오기 위한 로직 구현
  - Vue
    - 검색, 회원가입,로그인을 제외한 모든 기능 구현
    - Design



## :seedling: 목표 서비스 및 기능

|      |      기능       |                             설명                             |
| :--: | :-------------: | :----------------------------------------------------------: |
|  1   |    회원가입     |       simple JWT를 이용하여 유저 회원가입, 로그인 인증       |
|  2   |    로그아웃     |                  로컬에 저장된 토큰 값 제거                  |
|  3   |   마이페이지    | 가입시 기입한 유저정보, '보고싶어요'를 누른 영화 목록, 내가 쓴 리뷰 목록 |
|  4   |       DB        |  TMDB API를 이용하여 968개의 영화 data 및 19개 장르를 저장   |
|  5   |       DB        | user, review, comment의 데이터를 임의의 값으로 생성하여 저장 |
|  6   |  관리자페이지   | admin 계정으로  영화, 리뷰, 댓글,사용자에 관한 CRUD 모든 권한을 가짐 |
|  7   |   메인페이지    | 최신개봉작, 인기작, 평점이 높은 작품 총 3가지 카테고리에서 상위 30개를 swiper-slider로 구성 |
|  8   |    영화 뽑기    | 무작위로 5개의 영화를 추천하며, 다시 뽑을 수 있으며 영화 클릭시 상세정보를 표시 |
|  9   |   상세 페이지   |               영화에 대한 상세정보를 나타낸다.               |
|  10  |    리뷰 CRUD    |              리뷰를 작성, 읽기, 수정, 삭제 기능              |
|  11  |    댓글 CRUD    |              댓글을 작성, 읽기, 수정, 삭제 기능              |
|  12  |   보고싶어요    |          보고싶은 영화를 표시하여 마이페이지에 표시          |
|  13  |   리뷰 좋아요   |                       리뷰 좋아요 기능                       |
|  14  | 인피니티 스크롤 |   전체 리뷰를 표시할 때 인피니티 스크롤 기능이용 하여 구현   |
|  15  |  리뷰 상세보기  | 영화 상세페이지에서 각 영화에 대한 리뷰를 modal 상세하게 볼 수 있다. |



## :pen: 모델링(ERD)

![img](https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F5d3b345b-b92f-42e0-831d-ec47f0c3d739%2Ferd.jpg?table=block&id=7cf91dc1-2b72-4ae5-9a84-532f268ff565&spaceId=daa2d103-3ecd-4519-8c30-4f55e74c7ef4&width=2000&userId=ae89533d-229e-41bd-bd46-72a172ec196c&cache=v2)





## 구현 기능

### 메인 페이지

![image-20211125220506291](README.assets/image-20211125220506291.png)

- Nav Bar
  - CSPedia 로고와 home 버튼을 통해 메인화면으로 이동합니다.
  - 영화뽑기 클릭 시 영화 뽑기 페이지로 이동합니다.
  - 검색창을 이용해 검색이 가능하며, 검색어와 관련된 이름을 가진 영화제목들이  자동완성 목록에 나타납니다
  - 로그인 시 프로필 페이지로 이동 및 로그아웃 하는 버튼이 나타납니다.
  - 비로그인 시 로그인하는 버튼이 생기며, 클릭 시 로그인 페이지로 이동합니다.
- 슬라이더
  - swiper-slider 기능을 이용해 영화 포스터를 클릭한 상태에서 움직이면 영화목록이 이동합니다.
  - 영화는 각 카테고리별 상위 20개만 표시합니다.
  - 각 영화 포스터를 클릭하면 해당 영화의 상세페이지로 이동합니다.



### 검색 페이지

![image-20211125221052551](README.assets/image-20211125221052551.png)

- 검색기능
  - 검색할 영화를 입력할 때 입력하는 글자와 일치하는 부분이 있는 영화제목들이 자동완성으로 나타납니다.
  - 검색어 목록에서 영화 제목을 클릭하면 해당 영화의 상세 페이지로 이동합니다.
  - 검색어만 입력 후, 버튼 및 엔터 키를 입력하면 해당 검색어와 관련된 영화 목록들이 간단한 설명과 함께 card 형태로 나타납니다.
  - 검색 된 목록의 영화들은 클릭 시 해당 영화의 상세페이지로 이동하게 됩니다.
  - 빈 검색어를 입력할 경우, 에러 문구가 발생합니다.

 

#### :warning: 애로사항

- 자동완성 구현을 어떻게 구현할 지 고민을 많이 했습니다.
- 다양한 방법이 있지만 구현이 어려워서  startswith를 이용해 실시간으로 입력하는 글자가 앞에서 부터 포함된 영화제목을 찾고, 그 영화정보를 가져오는 방식으로 구현하였습니다.
- 빈 검색어를 검색했을 때 화면이 아무것도 나타나지 않는 문제가 발생했었으며, 에러문구를 발생시켜 검색이 되지 않도록 구성했습니다.
- 자동완성 목록을 구현할 때 검색어 목록이 생길때 마다 nav bar가 같이 커지는 문제가 발생하여 해결하는 데 어려움이 있었습니다.
- 자동완성 목록의 position을 absolute로 가져가면서 해결할 수 있었습니다. 

### 

### 로그인, 회원가입 페이지

![image-20211125222522440](README.assets/image-20211125222522440.png)

![image-20211125222543610](README.assets/image-20211125222543610.png)

- 로그인 및 회원가입

  - 사이트의 모든 기능을 사용하기위해서는 로그인이 필요합니다.
  - nav bar의 로그인 버튼, 로그인이 필요한 페이지로 들어가면 로그인 페이지 자연스럽게 이동합니다.
  - 아이디, 비밀번호를 이용해 로그인을 할 수 있습니다.
  - 아이디가 없다면 회원가입 버튼을 클릭하면 로그인 양식에서 슬라이드로 이동하고 회원가입 양식이 나타납니다.
  - 회원가입이 되어있지 않다면 로그인 도중 입력한 아이디, 비밀번호 값을 그대로 회원가입 페이지로 가지고 이동합니다. 그리고 나머지 양식을 입력한다면 원활한 가입이 가능합니다.
  - 가입 후 로그인 버튼을 누른다면 다시 로그인 양식이 슬라이드로 나타납니다.
  - 만약 양식이 어긋난다면 에러 문구가 발생합니다.

  
#### :warning: 애로사항

- 백엔드 부분에서의 로그인, 회원가입 로직 구현은 어렵지 않았으며, simple jwt는 공식문서를 참고해 구현했습니다.
- 프론트 부분에서 위와 같은 화면을 구성하기 위해 css 부분이 어려웠으며 위와 같은 디자인의 css는 유튜버의 css 코드를 이용하여 우리의 양식에 맞게 구현하는 것에서 애를 먹었습니다.
- 처음 써보는 css기능과 css를 잘 다루지 못해서 구현에 문제가 생겨 시간이 많이 쓰였습니다.



### 마이페이지(프로필)

![image-20211125223520908](README.assets/image-20211125223520908.png)

- 프로필 페이지
  - 회원가입시 입력한 기본정보(username과 email)가 나타납니다.
  - 현재 로그인한 유저가 영화 상세페이지에서 보고싶어요를 클릭한 모든 영화들이  한줄에 5개씩 나타냅니다.
  - 영화를 클릭하면 해당 영화의 상세 페이지로 이동합니다.
  - 현재 로그인한 유저가 작성한 리뷰들이 모두 나타납니다.
  - 해당 리뷰 클릭 시 리뷰 상세페이지가 modal로 나타나며 수정 및 삭제를 할 수 있습니다.





## **영화 상세정보 페이지**

- Home 화면에서 표시되는 각 영화를 클릭하면 영화의 상세정보 페이지에 들어오게 됩니다.

- 영화 상세정보 페이지는 다음과 같이 두 부분으로 구성됩니다.



#### 1. 영화에 대한 정보를 표시하는 부분

![image-20211125221511769](README.assets/image-20211125221511769-16378499391542.png)





- 선택한 영화에 대한 포스터 이미지, 영화 기본정보, 감독 및 출연진, 평점을 확인할 수 있습니다.
- 영화 줄거리와 Trailer 영상도 확인할 수 있습니다. Trailer의 경우 API를 통해 TMDB에서 가져온 데이터 중 `video_path` 와 vue bootstrap의 `<b-embed>` 태그를 이용하였습니다.
- 보고싶어요 버튼을 클릭하면 색과 아이콘이 바뀌며 영화가 회원의 위시리스트에 추가됩니다.
- 리뷰쓰기 버튼을 누르면 영화에 대한 리뷰를 작성할 수 있는 화면으로 이동합니다. 비로그인 사용자의 경우 허용되지 않습니다.



![image-20211125223034402](README.assets/image-20211125223034402-16378499391531.png)



- 리뷰 작성의 경우 제목과 내용을 작성하지 않거나 평점을 1점 미만으로 준 경우 리뷰 작성이 되지 않게 처리하였습니다.
- 작성 이후엔 해당 영화 디테일 페이지로 이동합니다.







#### 2.영화에 달린 리뷰를 표시하는 부분

![image-20211125221645978](README.assets/image-20211125221645978-16378499391543.png)



- 해당 영화에 달린 사용자들의 모든 리뷰를 확인할 수 있는 부분입니다.
- 위의 리뷰작성 버튼을 통해 리뷰를 작성 시, 해당 부분에 바로 추가됩니다.
- 리뷰의 경우 한 줄에 두 개씩 카드 형태로 표시되게 했으며, 글쓴이와 평점, 리뷰 제목 및 내용, 받은 좋아요 수가 표시됩니다.
- 카드를 클릭할 경우 리뷰 상세보기 화면이 모달창으로 표시됩니다.

![image-20211125223427230](README.assets/image-20211125223427230-16378499391544.png)



- 위와 같이 모달창으로 리뷰의 세부 내용이 표시되고, 작성자의 경우 수정 및 삭제버튼이 표시되어 수정 및 삭제가 가능합니다.
- 또한 좋아요와 댓글 달기가 가능합니다.
- 댓글의 경우 본인이 작성한 댓글의 옆에는 삭제 버튼이 표시됩니다.
- 비로그인 사용자의 경우 댓글 보기와 리뷰작성이 불가하도록 구현했습니다.







## 영화 추천 페이지

![image-20211125224627357](README.assets/image-20211125224627357.png)

- 영화 추천에 해당하는 기능입니다.

- 무슨 영화를 볼지 고민되는 사람들에게 랜덤으로 5개의 영화를 추천해주는 페이지입니다.
- 로그인한 유저가 이미 리뷰를 작성한 영화는 제외하고, DB에 있는 968개의 영화 중 랜덤으로 영화를 추천해줍니다.



![image-20211125224752437](README.assets/image-20211125224752437.png)

- 버튼을 누르면 위와 같은 로딩 화면이 등장하고





![image-20211125224828429](README.assets/image-20211125224828429.png)

- 다섯 개의 영화가 뒤집어진채로 주어집니다.
- 마우스를 해당 부분에 올리면 해당 부분이 뒤집어지며 뽑은 영화가 표시됩니다.





![image-20211125224939425](README.assets/image-20211125224939425.png)

- 관심있는 영화를 클릭하면, 영화에 대한 디테일 정보가 모달창으로 표시됩니다.
- 페이지를 이동하지 않고 디테일 화면을 확인함으로서 유저가 뽑은 영화 목록을 유지할 수 있습니다.
- 모달창으로 뜬 영화 상세 화면은 영화 상세 페이지와 모든 기능이 동일합니다. 만약 유저가 뽑은 영화를 보고싶다면, 보고싶어요 버튼을 클릭함으로서 자신의 위시리스트에 추가해놓을 수 있습니다.





## :warning: 애로사항

### DATA 수집 및 DUMP DATA

- 프로젝트 초반에 API를 활용하여 TMDB에서 데이터를 수집하는 과정에서 생각치도 못한 많은 어려움에 부딫혔다. 단순히 API 요청을 통해 데이터를 받아오는 것이 아니라, 필요한 데이터 셋을 얻기 위해선 요청을 통해 받은 여러 데이터들을 처리하고 합치는 과정이 필요했기 때문에 마냥 쉬운 과정은 아니었다.

- 데이터를 DB에 저장한 후, DUMP를 시도하는 과정에서도 많은 오류가 발생했다. 그 중 가장 난감했던 오류는 다음과 같았다.

```python
CommandError: Unable to serialize database: 'cp949' codec can't encode character '\xe9' in position 17: illegal multibyte sequence
Exception ignored in: <generator object cursor_iter at 0x000002142DD485F0>
Traceback (most recent call last):
  File "C:\Users\Sun\Desktop\ssafy6\assignment\final-pjt\pjt-final-back\venv\lib\site-packages\django\db\models\sql\compiler.py", line 1649, in cursor_iter
    cursor.close()
sqlite3.ProgrammingError: Cannot operate on a closed database.
```

- 기존의 genre 데이터는 dump가 잘 되었는데 movie 데이터만 오류가 발생한 것으로 보아, model의 필드 중 일대다 or 다대다 관계가 있을 경우 발생하는 오류같았다.

- 다음과 같이 명령어를 바꾸어서 해결했다.

```python
python -Xutf8 manage.py dumpdata --indent 4 movies.Movie > movies.json
```





### DATA SERIALIZING & AXIOS

- 리뷰를 작성하기 위한 CreateReview.vue 를 만들 때 발생했던 오류때문에 어려움을 겪었다.
- 리뷰 작성과정에서 axios 요청 시 계속해서 400 ERROR (Bad request) 가 발생했다. 데이터도 잘 넘어가고 육안으로 보기에 유효성 검사에도 딱히 걸리지 않는데.....왜???

- 문제의 코드는 다음과 같다.

```javascript
axios({
    method: 'post',
    url: `http://localhost:8000/community/${this.movieId}/create/`,
    data: [{
      title,
      content,
      rank,
    }],
    headers: {
      Authorization: `Bearer ${accessToken}`
    },
  })
    .then(response => {
      console.log(response)
      alert('리뷰가 작성되었습니다.')
      this.$router.push( { name: 'MovieDetail', params: { movieId: this.movieId } } )
    })
    .catch(error => {
      error
      alert('내용을 모두 작성해주세요')
    })
```



- 문제를 해결하기 위해 다음과 같은 방법들을 시도했다.

1. serializers.py 수정

   - comment model의 경우 FK인 user, review 를 read_only 로 처리해주었더니 bad request 문제가 해결되었다. review 도 비슷하게 코드를 수정했다.

   ```PYTHON
   class ReviewSerializer(serializers.ModelSerializer):
       class Meta:
           model = Review
           fields = "__all__"
           read_only_fields = ('user', 'movie', )
   ```

   - 하지만 이 것만으론 문제가 해결되지 않았다.



2. [views.py](http://views.py/) 에서 상세한 오류 원인을 탐색

   - 디버깅을 통해 serializer 생성 후 validation 이 실패하고 있음을 알았고, 실패의 원인을 정확하게 분석하고자 serializer.errors 를 이용했다. 해당 코드를 통해 왜 에러가 발생하는지에 대한 구체적인 원인을 알아볼 수 있다.

   ```python
   @api_view(['POST'])
   @permission_classes([IsAuthenticated])
   def create_review(request, movie_id):
       movie = get_object_or_404(Movie, pk=movie_id)
   
       serializer = ReviewSerializer(data=request.data, many=True)
       serializer.is_valid()
       print(serializer.errors)
   
       if serializer.is_valid(raise_exception=True):
           serializer.save(movie=movie, user=request.user)
           
           return Response(serializer.data, status=status.HTTP_201_CREATED)
   ```





- 원인 분석을 통해, 요청의 data 부분이 잘못되었음을 알 수 있었다.
- 다음과 같이, 데이터 부분을 리스트로 한 번 감싸주고 난 뒤 요청을 보내 해결했다.

```
data: [{
    title,
    content,
    rank,
  }],
```

- 기존의 데이터는 보통 {} 형식으로 넣었기 때문에 오류의 원인을 찾는데에 시간이 꽤 걸렸다.






## :man_facepalming: 느낀점

- 김치우

하루하루가 시간이 너무 빨리 지나가서 일주일이 사흘 같았습니다. 싸피에 들어와 처음 프로그래밍을 접했던 처음해보는 프로젝트였습니다. 처음에는 의욕이 넘쳐 빠르게 기본기능 구현하고 어떤 새로운 기능을 추가할 지 생각했으나 시간이 지날수록 기본기능에 충실하는 것으로 목표가 바뀌었습니다.  기본 기능을 구현하는 것도 처음부터 하려니 쉽지않았습니다. 한 학기동안 했던 것들을 되짚어 보고, 생각이 나지 않는다면 교재를 참고하고 모르는 기능은 구글링을 통해 해결해 나갔습니다. 그 과정에서 부족한 저를 보면서 프로젝트 이후 어떻게 복습을 할 지 가이드 라인이 잡히기도 했습니다. 또한 팀원과 서로가 맡은 부분에서 발생한 문제를 함께 고민하여 해결하고, 정말 해결이 힘들때만 교수님의 도움을 받았으며, 이 모든 과정에서 실력이 또한 늘었다고 생각합니다.

 실력도 없는데 너무 앞서나간거 같았네요. 특히 모델링부터 최종 작업물까지 단계적으로 일을 해나가는 것이 조금 낯설었습니다. 하지만 함께 하는 팀원 선구님 덕분에 마음만 앞서던 저를 차근차근 하나씩 진행할 수 있도록 잡아주셨습니다. 도움을 많이 받아 버스를 탄 것 같아 항상 감사했습니다. 처음 해본 프로젝트여서 많은 것들을 배울 수 있었으며 해결되지 않아 밤잠을 설쳐 피곤한 날도 많았지만 그 과정이 단순히 힘든것이 아닌 재미있었으며, 개발자로서 한 걸음 내딛은 것이라 생각합니다.





- 이선구

SSAFY에 입과한 이후 짧게 프로젝트를 진행했었지만, 본격적으로 배운 기술들을 활용하여 진행한 첫 프로젝트였다. `내가 잘 할 수 있을까...?` 란 걱정과 재밌겠다라는 기대 속에서 프로젝트를 시작했다.

프로젝트 진행을 통해 초기 프로젝트에 대한 컨셉 선정과 기획, 화면 디자인, 모델링 등 사전작업이 굉장히 중요함을 알게 되었다. 우리 팀의 경우 초기 모델링에 있어 조금 부족했던 부분이 있었기 때문에, 이후 필요한 기능을 구현하는 데에 가끔 어려움을 느끼곤 했다. 결국 모델링을 잘 하기 위해선 기능이나 화면에 대한 기획이 선행해야 하고, 기획에는 팀의 컨셉과 방향을 잘 잡는 것이 중요하다. 이런 부분들을 잘 기억해서, 앞으로 개발자로서 진행할 프로젝트들에 적용해야 겠다는 생각이 들었다.

이번 프로젝트에서 프론트 엔드 개발을 주로 맡았지만, 백앤드 개발도 함께 했다. 이 과정을 통해 그 동안 어렴풋이 느끼던 백엔드와 프론트엔드에 대한 개념이 명확해졌다. 만약 내가 프론트 엔드 개발만 했다면 생각하지 못했을 백엔드 개발 부분에서의 어려움과 고충을 함께 배울 수 있었던 것 같다. 이번 프로젝트를 통해 백엔드과 프론트 엔드 개발자 각각의 역량도 중요하지만, 두 파트에서의 활발하고 잦은 소통과 솔직함이 개발 과정에서 굉장히 중요함을 깨닫게 되었다.

javaScript와 Vue를 활용한 개발에서 많은 재미를 느꼈던 것 같다. 유저의 입장에서 직접 웹을 사용한다고 생각하면서 페어와 함께 프론트 엔드의 많은 부분을 개선하고, 수정해나갔다. 이 과정에서 결과물이 조금씩 다듬어지는 것을 보며 많은 뿌듯함을 느꼈다!! 큰 문제 없이 결과물을 예정대로 만들고, 갈등 없이 무난하게 프로젝트를 끝낼 수 있었던 것 같아 만족스럽다. 고생한 치우님과 스스로에게 박수를 보내고 싶다!!
